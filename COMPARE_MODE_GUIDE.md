# 图像对比功能使用指南

## 🎯 功能概述

新增了三种图像显示模式，方便您对比处理前后的效果：
1. **处理后**：显示应用所有调整后的图像（默认）
2. **原图**：一键切换显示原始图像
3. **对比**：左右分屏对比原图和处理后的图像

## ✨ 功能特性

### 1. 处理后模式（默认）
- 显示应用所有滤镜和调整后的图像
- 这是默认的工作模式
- 可以实时预览所有调整效果

### 2. 原图模式
- 一键切换查看原始图像
- 不会丢失任何处理效果
- 再次切换回"处理后"即可恢复

### 3. 对比模式
- **左边**：显示完整的原始图像
- **右边**：显示完整的处理后图像
- **间隙**：两张图片之间有20px的间隙
- **标签**：左上角显示"原图"和"处理后"标识（黑色背景，白色文字）

## 📖 使用方法

### 基础操作

1. **导入图片**
   ```
   点击"导入图片"或拖拽图片到画布
   ```

2. **应用调整**
   ```
   使用左侧控制面板调整各种参数
   例如：亮度、对比度、RGB通道等
   ```

3. **切换显示模式**
   ```
   在画布下方找到三个按钮：
   - 处理后（默认蓝色高亮）
   - 原图
   - 对比
   ```

### 典型工作流程

#### 场景1：快速查看原图
```
1. 应用了多个调整后
2. 想快速看看原图是什么样的
3. 点击"原图"按钮
4. ✅ 立即显示原始图像
5. 点击"处理后"按钮
6. ✅ 恢复到处理后的效果
```

#### 场景2：对比调整效果
```
1. 应用了直方图均衡
2. 想看看效果是否明显
3. 点击"对比"按钮
4. ✅ 左边显示原图，右边显示处理后
5. 可以清晰看到差异
```

#### 场景3：微调参数
```
1. 点击"对比"按钮
2. 保持对比模式
3. 调整参数（如均衡强度）
4. ✅ 实时看到右半边的变化
5. 左半边原图保持不变，方便对比
```

## 🎨 视觉效果

### 处理后模式
```
┌─────────────────────┐
│                     │
│    处理后的图像      │
│                     │
└─────────────────────┘
```

### 原图模式
```
┌─────────────────────┐
│                     │
│      原始图像        │
│                     │
└─────────────────────┘
```

### 对比模式
```
┌──────────┐  ┌──────────┐
│ 原图     │  │ 处理后   │
│          │  │          │
│  完整图  │  │  完整图  │
│          │  │          │
└──────────┘  └──────────┘
   左边图片      右边图片
      ↑20px间隙↑
```

## 💡 使用技巧

### 技巧1：评估调整效果
```
问题：不确定调整是否改善了图像
解决：
1. 应用调整
2. 点击"对比"
3. 观察左右差异
4. 如果效果不明显，继续调整
```

### 技巧2：保持原图参考
```
问题：调整时想随时参考原图
解决：
1. 点击"对比"模式
2. 保持这个模式
3. 调整各种参数
4. 左边完整原图始终可见
5. 右边实时显示处理效果
6. 两张完整图片方便详细对比
```

### 技巧3：快速切换对比
```
问题：想快速在原图和处理后之间切换
解决：
使用键盘快捷键（如果实现）：
- 按住 Space：临时显示原图
- 松开 Space：恢复处理后
（当前版本需点击按钮）
```

### 技巧4：评估直方图均衡
```
场景：调整直方图均衡强度
最佳实践：
1. 点击"对比"模式
2. 拖动均衡强度滑块
3. 左边显示完整原图
4. 右边实时显示均衡效果
5. 两张完整图片便于详细比较
6. 找到最佳均衡强度
```

## 🔧 技术实现

### 显示模式切换

```typescript
// 三种模式
type CompareMode = 'processed' | 'original' | 'split';

// 切换模式
setCompareMode('original');  // 显示原图
setCompareMode('processed'); // 显示处理后
setCompareMode('split');     // 显示对比
```

### Canvas绘制逻辑

**原图模式**
```typescript
// 直接绘制原始ImageData
tempCtx.putImageData(originalImageData, 0, 0);
ctx.drawImage(tempCanvas, x, y, width, height);
```

**对比模式**
```typescript
// 计算两张图的尺寸和位置
const gap = 20; // 间隙
const singleWidth = (width - gap) / 2;
const leftX = x;
const rightX = x + singleWidth + gap;

// 左边：完整原图
tempCtx.putImageData(originalImageData, 0, 0);
ctx.drawImage(tempCanvas, leftX, y, singleWidth, height);

// 右边：完整处理后图像
offscreenCtx.putImageData(currentImageData, 0, 0);
ctx.drawImage(offscreenCanvas, rightX, y, singleWidth, height);

// 添加标签
ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
ctx.fillRect(leftX, y, 60, 30);
ctx.fillStyle = 'white';
ctx.fillText('原图', leftX + 15, y + 20);
```

### 状态管理

```typescript
// 状态
const [compareMode, setCompareMode] = useState<'processed' | 'original' | 'split'>('processed');

// 监听变化
useEffect(() => {
  if (canvasManagerRef.current && hasImage) {
    canvasManagerRef.current.updatePreview(compareMode);
  }
}, [compareMode, hasImage]);
```

## 📊 性能优化

### 优化措施
1. **临时Canvas**：使用临时canvas避免重复创建
2. **并排绘制**：直接绘制两张完整图片，无需裁剪
3. **状态缓存**：原图ImageData始终保存在内存中
4. **按需绘制**：只在模式切换时重新绘制
5. **间隙优化**：20px间隙使两张图片清晰分离

### 内存使用
- 原图ImageData：始终保存
- 处理后ImageData：始终保存
- 临时Canvas：仅在绘制时创建
- 总内存：约为图像大小的2倍

## ⚠️ 注意事项

### 1. 原图不可编辑
- 原图模式下，图像是只读的
- 无法在原图模式下应用调整
- 需要切换回"处理后"模式才能继续编辑

### 2. 对比模式的调整
- 对比模式下可以调整参数
- 右边的完整图片会实时更新
- 左边的完整原图保持不变
- 两张完整图片便于详细对比

### 3. 裁剪操作
- 裁剪操作会更新原图
- 裁剪后，原图变为裁剪后的图像
- 对比模式会显示裁剪后的原图

### 4. 导出功能
- 导出时始终导出处理后的图像
- 不会导出对比模式的并排效果
- 如需导出原图，请先切换到原图模式再导出

### 5. 图片缩放
- 对比模式下，每张图片宽度约为原来的一半
- 两张图片保持相同的缩放比例
- 20px间隙不影响图片显示质量

## 🎯 应用场景

### 场景1：人像修图
```
1. 导入人像照片
2. 调整亮度、对比度
3. 点击"对比"查看效果
4. 微调参数直到满意
5. 切换到"处理后"
6. 导出最终图像
```

### 场景2：风景照增强
```
1. 导入风景照片
2. 应用直方图均衡
3. 点击"对比"
4. 左边完整原图，右边完整处理后
5. 详细观察天空和地面的变化
6. 调整均衡强度
7. 对比两张完整图片
8. 找到最佳平衡点
```

### 场景3：产品图优化
```
1. 导入产品图片
2. 调整RGB通道
3. 点击"对比"
4. 确保色彩准确
5. 应用锐化
6. 再次对比确认
```

## 🆕 更新日志

### v0.4.0 (2025-11-05)
- ✅ 添加三种显示模式（处理后/原图/对比）
- ✅ 在画布下方添加模式切换按钮
- ✅ 实现左右分屏对比功能
- ✅ 添加蓝色分割线和标签
- ✅ 支持实时切换，不丢失处理效果
- ✅ 修复默认均衡强度显示问题（从100改为0）

## 🔮 未来计划

- [ ] 添加键盘快捷键支持
- [ ] 添加可拖动的分割线
- [ ] 支持上下分屏对比
- [ ] 添加放大镜功能
- [ ] 支持多图对比（对比不同参数）

---

**项目地址**: https://github.com/herbal-rin/Fast-image-processing
**当前版本**: v0.4.0
**最后更新**: 2025-11-05

